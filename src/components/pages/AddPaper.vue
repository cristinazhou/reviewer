<template>
  <Form ref="formValidate" :model="formValidate" :rules="ruleValidate" :label-width="80">
    <FormItem label="论文标题" prop="paperTitle">
      <Input v-model="formValidate.paperTitle" placeholder="Enter your title"/>
    </FormItem>
    <FormItem label="论文作者" prop="paperAuthor">
      <Input v-model="formValidate.paperAuthor" placeholder="Enter your author"/>
    </FormItem>
    <FormItem label="所有者" prop="paperOwner">
      <Input v-model="formValidate.paperOwner" placeholder="Enter your owner"/>
    </FormItem>
    <FormItem label="论文权限" prop="authority">
      <RadioGroup v-model="formValidate.authority">
        <Radio label="true" value="true">公开论文</Radio>
        <Radio label="false" value="false">私有论文</Radio>
      </RadioGroup>
    </FormItem>
    <FormItem >
      <Transfer
        :data="dataLeft"
        :target-keys="targetKeys"
        :list-style="listStyle"
        :render-format="render3"
        :operations="['To left','To right']"
        filterable
        @on-change="handleChange3">
        <div :style="{float: 'right', margin: '5px'}">
          <Button type="ghost" size="small" @click="reloadMockData">Refresh</Button>
        </div>
      </Transfer>
      <!--<form  class="file">-->
        <!--<input type="file" @change="getFile($event)" />-->
        <!--<button @click="submitForm($event)">上传</button>-->
      <!--</form>-->
    </FormItem>


    <FormItem>
      <Button type="primary" @click="submitForm($event)">Submit</Button>
      <Button type="ghost" @click="handleReset('formValidate')" style="margin-left: 8px">Reset</Button>
    </FormItem>
  </Form>


</template>

<script>
  export default {
    name: "AddPaper",
    data() {
      return {
        formValidate: {
          paperTitle: '',
          paperAuthor: '',
          paperOwner: '',
          authority: '',
          file: '',

        },
        dataLeft: this.getMockData(),
        targetKeys: this.getTargetKeys(),
        listStyle: {
          width: '250px',
          height: '300px',
        ruleValidate: {
          paperTitle: [
            {required: true, message: 'The title cannot be empty', trigger: 'blur'}
          ],
          paperAuthor: [
            {required: true, message: 'The author cannot be empty', trigger: 'blur'}
          ],
          paperOwner: [
            {required: true, message: 'The owner cannot be empty', trigger: 'blur'}
          ],
          authority: [
            {required: true, message: 'Please select authority', trigger: 'change'}
          ]

        }
      }

    };   },
    methods: {
      getMockData () {
        var mockData = [];
        this.$axios({
          method:'get',
          url:'/file/user_list',

        })
          .then(function(response){
            if(response.status===200) {
              for(let i=0;i<response.data.data.length;i++){

                mockData.push({
                  key:i,
                  label:response.data.data[i].fileName,
                  fileType:response.data.data[i].fileType,


                  //disabled: Math.random() * 3 < 1
                });


              }

            }else{
              console.log('error');
            }

          })
          .catch(function (error) {
            console.log('error')

          })

        // for (let i = 1; i <= 20; i++) {
        //   mockData.push({
        //     key: i.toString(),
        //     label: 'Content ' + i,
        //     description: 'The desc of content  ' + i,
        //     disabled: Math.random() * 3 < 1
        //   });
        // }
        return mockData;
      },
      getTargetKeys () {
        return this.getMockData()
          .filter(() => Math.random() * 2 > 1)
          .map(item => item.key);
      },
      handleChange3 (newTargetKeys) {
        this.targetKeys = newTargetKeys;
      },
      render3 (item) {
        return  item.label;
      },
      reloadMockData () {
        this.dataLeft = this.getMockData();
        this.targetKeys = this.getTargetKeys();
      },
      handleReset(name) {
        this.$refs[name].resetFields();
      },
      // getFile(event) {
      //   this.file = event.target.files[0];
      // },
      submitForm(event) {
        event.preventDefault();
        let file = this.formValidate.file;
        let formData = new FormData();
        for(let i=0;i<targetKeys.length;i++)
        {
          formData.append('fileId', this.targetKeys.fileId);//

        }
        formData.append('paperTitle',this.formValidate.paperTitle);
        formData.append('paperAuthor',this.formValidate.paperAuthor);
        formData.append('paperOwner',this.formValidate.paperOwner);
        formData.append('ispublic',this.formValidate.authority);
        this.$axios({
          method: 'post',
          url: '/paper/create',
          data:formData,})
          .then(function (response) {
            alert(111)
            if (response.status === 200) {
              alert(111)
              /*这里做处理*/
            }
          })
      }
    }


  };
</script>



