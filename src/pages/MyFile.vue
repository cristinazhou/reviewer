<template>
    <div>
        <Input v-model=value placeholder="请输入文件名" style="width: 200px"/>
        <i-button type="primary" @click="search">搜索</i-button>
        <form class="file">
            <input type="file" @change="getFile($event)"/>
            <button @click="submitForm($event)">上传</button>
        </form>
        <Table :columns="columns" :data="fileSet">
        </Table>
        <Page :total="dataCount"
              :current="pageNum"
              :page-size="pageSize"
              show-elevator show-sizer show-total
              placement="top"
              @on-change="handlePage" @on-page-size-change='handlePageSize'>
        </Page>
    </div>
</template>

<script>
  import DropDownFile from '@/components/dropdowns/DropDownFile.vue'
  export default {
    components: {
      DropDownFile: DropDownFile
    },
    computed: {
      fileDelete(){
        return this.$store.state.app.fileDelete;
      }
    },
    watch: {
      fileDelete(val){
        this.pageList();
      },
    },
    data(){
      return {
        dataCount: 40,
        pageNum: 1,
        pageSize: 10,
        value: '',
        file: '',
        columns: [{
          title: '序号',
          key: 'number'
        }, {
          title: '文件名',
          key: 'fileName'
        }, {
          title: '操作',
          key: 'operation3',
          render: function (h, params) {
            return h(DropDownFile, {
              props: {
                fileId: params.row.id
              }
            })
          }
        }],
        fileSet: []
      };
    },
    methods: {
      handlePage(){

      },
      handlePageSize(){

      },
      getFile(event) {
        this.file = event.target.files[0];
      },
      submitForm(event) {
        let message = this.$Message;
        event.preventDefault();
        let file = this.file;
        let formData = new FormData();
        formData.append('file', file);
        this.$axios({
          method: 'post',
          url: '/file/upload',
          data: formData
        }).then(function (response) {
          message.success('文件上传成功');
        })
      },
      search(){
        let fileSet = this.fileSet;
        this.$axios.get('/file/user_search?keyWords=' + this.value)
          .then(function (response) {
            let data = response.data.data;
            let i = 1;
            data.forEach(function (file) {
                fileSet.push({
                  number: i,
                  id: file.id,
                  fileName: file.fileName
                });
                ++i;
              }
            )
          })
      },
      list(){
        let fileSet = this.fileSet;
        this.$axios({
          method: 'get',
          url: '/file/user_list'
        }).then(function (response) {
          let data = response.data.data;
          if (data) {
            let i = 1;
            data.forEach(function (file) {
                fileSet.push({
                  number: i,
                  id: file.id,
                  fileName: file.fileName
                });
                ++i;
              }
            )
          }
        })
      }
    },
    created() {
      this.list();
    }
  };
</script>
<style lang="scss" type="text/scss">
</style>



